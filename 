[1mdiff --git a/changeMainPage.jsx b/changeMainPage.jsx[m
[1mindex c0fe7c6..13e6c87 100644[m
[1m--- a/changeMainPage.jsx[m
[1m+++ b/changeMainPage.jsx[m
[36m@@ -6,7 +6,7 @@[m [mvar myText=app.findGrep();[m
 for  (var i=0; i<myText.length;i++)[m
 {[m
     myText[i].parentTextFrames[0].parentPage.appliedMaster=NothingEnum.NOTHING;[m
[31m-    myText[i].parentTextFrames[0].nextTextFrame.parentPage.appliedMaster=NothingEnum.NOTHING;[m
[32m+[m[32m //   myText[i].parentTextFrames[0].nextTextFrame.parentPage.appliedMaster=NothingEnum.NOTHING;[m
 //è·¨é¡µçš„æ“ä½œ       [m
        // myText[i].parentTextFrames[0].nextTextFrame.parentPage.parent.appliedMaster=NothingEnum.NOTHING;[m
 [m
[36m@@ -25,13 +25,19 @@[m [mfunction myNoTextTextFrames(){[m
     var myDoc=app.activeDocument;[m
     var myTextFrames=myDoc.textFrames;[m
     for (var x=0;x<myTextFrames.length;x++){[m
[31m-        if (myTextFrames[x].contents.length<=1){[m
[32m+[m[32m        if (myTextFrames[x].contents.length<1){[m
         //  alert(myTextFrames[x].contents.length);[m
[32m+[m[32m        try{[m
           myTextFrames[x].parentPage.appliedMaster=NothingEnum.NOTHING;[m
[31m-            }[m
[32m+[m[32m            }catch(err)[m
[32m+[m[32m  {[m
[32m+[m[32m  //åœ¨è¿™é‡Œå¤„ç†é”™è¯¯[m
[32m+[m[32m  alert(err);[m
[32m+[m[32m  }[m
[32m+[m[41m        [m
 [m
 }[m
     [m
[31m-    [m
[32m+[m[32m    }[m
     [m
     }[m
\ No newline at end of file[m
[1mdiff --git a/changeTrack0.2.jsx b/changeTrack0.2.jsx[m
[1mindex 483f4eb..4c70e3f 100644[m
[1m--- a/changeTrack0.2.jsx[m
[1m+++ b/changeTrack0.2.jsx[m
[36m@@ -4,22 +4,22 @@[m [mfunction main() {[m
 [m
   var myDocument = app.activeDocument;[m
   var myLayer = myDocument.layers.add();[m
[31m-  var myTextStyle=getTextStyle(myDocument,"æ›´æ”¹");[m
[31m-  var myColorA, myColorB;[m
[32m+[m[32m  var myTextStyle = getTextStyle(myDocument, "æ›´æ”¹");[m
[32m+[m[32m  var myColorA, myColorB, myColorC;[m
 [m
 [m
 [m
   //é¢œè‰²[m
   try {[m
[31m-    myColorA = myDocument.colors.item("Red");[m
[32m+[m[32m    myColorA = myDocument.colors.item("Green");[m
     //If the color does not exist, trying to get its name will generate an error.[m
[31m-     myColorA.name;[m
[32m+[m[32m    myColorA.name;[m
   } catch (myError) {[m
     //The color style did not exist, so create it.[m
     myColorA = myDocument.colors.add({[m
[31m-      name: "Red",[m
[32m+[m[32m      name: "Green",[m
       model: ColorModel.process,[m
[31m-      colorValue: [0, 100, 100, 0][m
[32m+[m[32m      colorValue: [100, 0, 100, 0][m
     });[m
   }[m
   //Create another color.[m
[36m@@ -36,12 +36,52 @@[m [mfunction main() {[m
     });[m
   }[m
 [m
[32m+[m
[32m+[m[32m  try {[m
[32m+[m[32m    myColorC = myDocument.colors.item("Red");[m
[32m+[m[32m    //If the color does not exist, trying to get its name will generate an error.[m
[32m+[m[32m    myColorC.name;[m
[32m+[m[32m  } catch (myError) {[m
[32m+[m[32m    //The color style did not exist, so create it.[m
[32m+[m[32m    myColorC = myDocument.colors.add({[m
[32m+[m[32m      name: "Red",[m
[32m+[m[32m      model: ColorModel.process,[m
[32m+[m[32m      colorValue: [0, 100, 100, 0][m
[32m+[m[32m    });[m
[32m+[m[32m  }[m
[32m+[m
   myLayer = myDocument.activeLayer;[m
   //å½“å‰é¡µï¼Œå½“å‰æ–‡æœ¬æ¡†ï¼Œä¸»è¦ä½œç”¨æ˜¯å¯¹åŒé¡µé¢çš„ä¿®æ”¹ï¼Œæ±‡èšåœ¨ä¸€èµ·[m
   var presentPage;[m
   var presentTextFrame;[m
[32m+[m[32m  //å…¨å±€æ€»ä¹¦ç­¾[m
[32m+[m[32m  var myBookMarks = myDocument.bookmarks;[m
[32m+[m[32m  //å…¨å±€å½“å‰ä¹¦ç­¾[m
[32m+[m[32m  var prensentBookMarks;[m
   //èŽ·å–æ‰€æœ‰çš„æ›´æ”¹[m
   var mychanges = text_find_word(myDocument.stories);[m
[32m+[m[32m  //ä¸ºäº†è®©æ¯ä¸€é¡µçš„æ³¨é‡Šå’Œæ›´æ”¹éƒ½å‡ºçŽ°åœ¨ä¸€ä¸ªæ–‡æœ¬æ¡†ï¼Œåœ¨ä¸ä¿®æ”¹å¤ªå¤šä»£ç çš„æƒ…å†µä¸‹ï¼Œä¸€ä¸ªç®€å•çš„æŽ’åºæ˜¯åˆé€‚çš„ã€‚[m
[32m+[m
[32m+[m[32m  //è¿™ä¸ªæŽ’åºæ˜¯ä¸ªèˆ¶æ¥å“ï¼Œæˆ‘éƒ½ä¸æ˜¯å¾ˆæ˜Žç™½ä»–çš„å«ä¹‰[m
[32m+[m[32m  var by = function(name, minor) {[m
[32m+[m[32m    return function(o, p) {[m
[32m+[m[32m      var a, b;[m
[32m+[m[32m      if (o && p && typeof o === 'object' && typeof p === 'object') {[m
[32m+[m[32m        a = o[name];[m
[32m+[m[32m        b = p[name];[m
[32m+[m[32m        if (a === b) {[m
[32m+[m[32m          return typeof minor === 'function' ? minor(o, p) : 0;[m
[32m+[m[32m        }[m
[32m+[m[32m        if (typeof a === typeof b) {[m
[32m+[m[32m          return a < b ? -1 : 1;[m
[32m+[m[32m        }[m
[32m+[m[32m        return typeof a < typeof b ? -1 : 1;[m
[32m+[m[32m      } else {[m
[32m+[m[32m        thro("error");[m
[32m+[m[32m      }[m
[32m+[m[32m    }[m
[32m+[m[32m  }[m
[32m+[m[32m  mychanges.sort(by('page.id', by('id')));[m
   //å¾ªçŽ¯æ¯ä¸ªæ›´æ”¹ï¼Œå¹¶æ³¨å…¥åˆ°æ¯é¡µçš„æ›´æ”¹æ–‡æœ¬æ¡†[m
   for (var i = 0; i < mychanges.length; i++) {[m
     //åˆ¤æ–­æ›´æ”¹æ˜¯å¦åœ¨å½“å‰é¡µï¼Œå¦‚æžœåœ¨ï¼Œåœ¨å·²æœ‰æ–‡æœ¬æ¡†é‡Œæ·»åŠ å†…å®¹ï¼Œå¦‚æžœä¸åœ¨ï¼Œåˆ™é‡æ–°å»ºç«‹æ–‡æœ¬æ¡†ã€‚  [m
[36m@@ -49,6 +89,16 @@[m [mfunction main() {[m
 [m
       presentPage = mychanges[i].page;[m
       presentTextFrame = presentPage.textFrames.add();[m
[32m+[m
[32m+[m
[32m+[m[32m      //ç‰›é€¼çš„åˆ†çº§ä¹¦ç­¾å¼€å§‹[m
[32m+[m[32m      var myPageLinkDestination = myDocument.hyperlinkPageDestinations.add(presentPage);[m
[32m+[m[32m      prensentBookMarks = myBookMarks.add(myPageLinkDestination, {[m
[32m+[m[32m        name: "æ›´æ”¹é¡µ" + presentPage.index[m
[32m+[m[32m      });[m
[32m+[m
[32m+[m
[32m+[m
       //æ¸…é™¤å¯èƒ½çš„ç»•æŽ’[m
       presentTextFrame.textWrapPreferences.textWrapMode = TextWrapModes.NONE;[m
       //è¿™é‡Œå¼€å§‹å»ºç«‹æ–°çš„æ–‡æœ¬æ¡†ï¼Œä½ç½®ï¼Œæˆ‘é€‰æ‹©åœ¨é¡µé¢çš„å·¦ä¸Šè§’åˆ°å·¦ä¸‹è§’,ç„¶åŽå‘å·¦è¾¹åç§»100ã€‚[m
[36m@@ -69,14 +119,22 @@[m [mfunction main() {[m
     origin.textWrapPreferences.textWrapMode = TextWrapModes.NONE;[m
     origin.geometricBounds = [mychanges[i].position[1] - radius, mychanges[i].position[0] - radius, mychanges[i].position[1] + radius, mychanges[i].position[0] + radius];[m
     //   [mychanges[i].position[1], mychanges[i].position[0], mychanges[i].position[1] + 20, mychanges[i].position[2] + 30][m
[31m-    origin.fillColor = myColorA;[m
[32m+[m[32m    //å¯¹ç±»åˆ«åšå‡ºåˆ¤æ–­ï¼Œå¦‚æžœæ˜¯æ³¨é‡Šï¼Œé‚£ä¹ˆå°±æ·»åŠ çº¢è‰²ï¼Œåä¹‹ç”¨ç»¿è‰²[m
[32m+[m[32m    if (mychanges[i].types == "æ³¨é‡Š") {[m
[32m+[m[32m      origin.fillColor = myColorC;[m
[32m+[m
[32m+[m[32m    } else {[m
[32m+[m[32m      origin.fillColor = myColorA;[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m
     var idFrame = presentPage.textFrames.add();[m
     idFrame.textWrapPreferences.textWrapMode = TextWrapModes.NONE;[m
[31m-    idFrame.geometricBounds = [mychanges[i].position[1] - radius, mychanges[i].position[0] - radius, mychanges[i].position[1] + radius, mychanges[i].position[0] + radius];[m
[32m+[m[32m    idFrame.geometricBounds = [mychanges[i].position[1] - radius, mychanges[i].position[0] - radius - 1, mychanges[i].position[1] + radius, mychanges[i].position[0] + radius + 1];[m
     idFrame.contents = "" + mychanges[i].id;[m
 [m
     var myIndexText = idFrame.parentStory.texts.item(0);[m
[31m-    myIndexText .applyParagraphStyle(myTextStyle,true);[m
[32m+[m[32m    myIndexText.applyParagraphStyle(myTextStyle, true);[m
     myIndexText.fillColor = myColorB;[m
     myIndexText.justification = Justification.CENTER_ALIGN;[m
     myIndexText.pointSize = 7;[m
[36m@@ -88,7 +146,8 @@[m [mfunction main() {[m
     gl.paths.item(0).pathPoints[0].anchor = [mychanges[i].position[0], mychanges[i].position[1]];[m
     gl.paths.item(0).pathPoints[1].anchor = [mychanges[i].position[2], mychanges[i].position[1]];[m
     gl.strokeColor = myColorA;[m
[31m-    presentTextFrame.contents = presentTextFrame.contents + mychanges[i].id + "," + mychanges[i].user + mychanges[i].types + "äº†" + "â€œ" + mychanges[i].text + "â€" + "\r";[m
[32m+[m
[32m+[m[32m    presentTextFrame.contents = presentTextFrame.contents + mychanges[i].id + "." + mychanges[i].user + mychanges[i].types + "äº†" + "â€œ" + mychanges[i].text + "â€" + "\r";[m
     //è®¾ç½®æ–‡æœ¬æ ¼å¼[m
 [m
     //èŽ·å–æ–‡æœ¬æ ·å¼[m
[36m@@ -101,10 +160,31 @@[m [mfunction main() {[m
 [m
 [m
 [m
[31m-    //éƒé—·ï¼ŒåŸºäºŽæ ·å¼å±…ç„¶ä¼šå¯¼è‡´æ— æ•ˆï¼Œåªèƒ½æ›²çº¿æ•‘å›½äº†ã€‚[m
[31m-    var myText = presentTextFrame.parentStory.texts.item(0);[m
[31m-    myText.applyParagraphStyle(myTextStyle,true);[m
[31m-    myText.fillColor = myColorA;[m
[32m+[m[32m    var myText = presentTextFrame.parentStory.paragraphs[-1].texts.item(0);[m
[32m+[m[32m    myText.applyParagraphStyle(myTextStyle, true);[m
[32m+[m
[32m+[m[32m    var myLinkText = myText.characters.itemByRange(myText.characters[0], myText.characters[-2]).texts.item(0);[m
[32m+[m
[32m+[m
[32m+[m[32m    //åŠ å…¥è¶…é“¾æŽ¥[m
[32m+[m[32m    var mylinkSource = myDocument.hyperlinkTextSources.add(myLinkText);[m
[32m+[m[32m    var myLinkDestination = myDocument.hyperlinkTextDestinations.add(myIndexText);[m
[32m+[m[32m    myDocument.hyperlinks.add(mylinkSource, myLinkDestination);[m
[32m+[m
[32m+[m
[32m+[m[32m    //åœ¨æ¯ä¸€é¡µåŠ å…¥ä¹¦ç­¾[m
[32m+[m[32m    prensentBookMarks.bookmarks.add(myLinkDestination,{name:mychanges[i].id + "." + mychanges[i].types + "â€œ" + mychanges[i].text + "â€"});[m
[32m+[m
[32m+[m
[32m+[m
[32m+[m[32m    //å¯¹æ–‡æœ¬é¢œè‰²ä¹Ÿè¿›è¡Œæ›´æ”¹[m
[32m+[m[32m    if (mychanges[i].types == "æ³¨é‡Š") {[m
[32m+[m[32m      myText.fillColor = myColorC;[m
[32m+[m
[32m+[m[32m    } else {[m
[32m+[m[32m      myText.fillColor = myColorA;[m
[32m+[m[32m    }[m
[32m+[m
     myText.justification = Justification.LEFT_ALIGN;[m
     myText.pointSize = 8;[m
     myText.startParagraph = StartParagraph.ANYWHERE;[m
[36m@@ -116,13 +196,13 @@[m [mfunction main() {[m
 [m
 [m
 //èŽ·å–æ®µè½æ ·å¼[m
[31m-function getTextStyle(in_document,in_name) {[m
[32m+[m[32mfunction getTextStyle(in_document, in_name) {[m
   var myStyle;[m
 [m
   try {[m
     myStyle = in_document.paragraphStyles.item(in_name);[m
     //If the style does not exist, trying to get its name will generate an error.[m
[31m-   //ä¹Ÿå«ä¸€å£°å§,è¿™é‡Œæ˜¯ä¸ªå‘å•Šï¼ï¼[m
[32m+[m[32m    //ä¹Ÿå«ä¸€å£°å§,è¿™é‡Œæ˜¯ä¸ªå‘å•Šï¼ï¼[m
     myStyle.name;[m
   } catch (myError) {[m
     //æ–°å»ºæ ·å¼å‡ä¸æˆåŠŸï¼ŒinVaild=false[m
[36m@@ -134,6 +214,20 @@[m [mfunction getTextStyle(in_document,in_name) {[m
   return myStyle;[m
 }[m
 [m
[32m+[m[32m//èŽ·å–textå¯¹è±¡ä¸­çš„æ–‡æœ¬å†…å®¹[m
[32m+[m[32mfunction contentsOfText(inTexts) {[m
[32m+[m[32m  var myContents = "";[m
[32m+[m[32m  if (inTexts.length > 0) {[m
[32m+[m[32m    for (var j = 0; j < inTexts.length; j++) {[m
[32m+[m[32m      myContents += inTexts[j].contents;[m
[32m+[m
[32m+[m[32m    }[m
[32m+[m[32m  } else {[m
[32m+[m[32m    myContents = "è¿™é‡Œæœ‰ä¿®æ”¹";[m
[32m+[m[32m  }[m
[32m+[m
[32m+[m[32m  return myContents;[m
[32m+[m[32m}[m
 [m
 //èŽ·å–é¢œè‰²[m
 function getColor(in_document, colorName, in_colorValue) {[m
[36m@@ -141,7 +235,7 @@[m [mfunction getColor(in_document, colorName, in_colorValue) {[m
   try {[m
     //å› æ­¤å»ºè®®åœ¨uiä¸­å»ºç«‹æ­¤é¢œè‰²[m
     in_color = in_document.colors.item(colorName);[m
[31m-//å±…ç„¶éœ€è¦å«ä¸€å£°ï¼Œè‰¹ï¼[m
[32m+[m[32m    //å±…ç„¶éœ€è¦å«ä¸€å£°ï¼Œè‰¹ï¼[m
     in_color.name;[m
   } catch (myError) {[m
     //æ–°å»ºæ ·å¼å‡ä¸æˆåŠŸï¼ŒinVaild=false[m
[36m@@ -164,9 +258,33 @@[m [mfunction text_find_word(in_story) {[m
   var result = new Array(); // this will be our return value[m
 [m
   var myStories = in_story;[m
[32m+[m[32m  //è¿™é‡Œæ˜¯æ–‡ç« çš„å¾ªçŽ¯[m
   for (var i = 0; i < myStories.length; i++)[m
 [m
   {[m
[32m+[m[32m    //è¿™é‡Œæ˜¯èŽ·å–é™„æ³¨çš„å¾ªçŽ¯[m
[32m+[m[32m    for (var m = 0; m < myStories[i].notes.length; m++) {[m
[32m+[m[32m      var myResult = myStories[i].notes[m].storyOffset;[m
[32m+[m[32m      x = myResult.horizontalOffset;[m
[32m+[m[32m      y = myResult.baseline - 2; //é˜²æ­¢å’Œå…¶ä»–çš„é‡å ã€‚[m
[32m+[m[32m      z = myResult.horizontalOffset;[m
[32m+[m[32m      var id = myStories[i].notes[m].index;[m
[32m+[m[32m      var page = myStories[i].notes[m].storyOffset.parentTextFrames[0].parentPage;[m
[32m+[m[32m      var userName = myStories[i].notes[m].userName;[m
[32m+[m[32m      var myText = contentsOfText(myStories[i].notes[m].texts);[m
[32m+[m[32m      result.push({[m
[32m+[m[32m        "id": id,[m
[32m+[m[32m        "position": [x, y, z],[m
[32m+[m[32m        "types": "æ³¨é‡Š",[m
[32m+[m[32m        "text": myText,[m
[32m+[m[32m        "page": page,[m
[32m+[m[32m        "user": userName[m
[32m+[m[32m      });[m
[32m+[m
[32m+[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    //è¿™é‡Œæ˜¯èŽ·å–æ›´æ”¹åˆ—è¡¨çš„å¾ªçŽ¯[m
     if (myStories[i].trackChanges == true) {[m
       for (var m = 0; m < myStories[i].changes.length; m++) {[m
 [m
[36m@@ -181,16 +299,10 @@[m [mfunction text_find_word(in_story) {[m
           x = myResult[0].horizontalOffset;[m
           y = myResult[0].baseline;[m
           z = myResult[-1].horizontalOffset;[m
[31m-          //   if (myStories[i].changes[m].lines <= 1) {[m
 [m
[31m-          //     x = myStories[i].changes[m].lines[0].insertionPoints[0].horizontalOffset;[m
[31m-          //     y = myStories[i].changes[m].lines[0].insertionPoints[0].myResult.baseline;[m
[31m-          //     z = myStories[i].changes[m].lines[0].insertionPoints[-1].myResult.baseline;[m
[31m-          //   } [m
         }[m
 [m
 [m
[31m-[m
         var id = myStories[i].changes[m].index;[m
 [m
         var myChangeTypes;[m
[36m@@ -203,19 +315,7 @@[m [mfunction text_find_word(in_story) {[m
 [m
         var myText = contentsOfText(myStories[i].changes[m].texts);[m
 [m
[31m-        function contentsOfText(inTexts) {[m
[31m-          var myContents = "";[m
[31m-          if (inTexts.length > 0) {[m
[31m-            for (var j = 0; j < inTexts.length; j++) {[m
[31m-              myContents += inTexts[j].contents;[m
[31m-[m
[31m-            }[m
[31m-          } else {[m
[31m-            myContents = "è¿™é‡Œæœ‰ä¿®æ”¹";[m
[31m-          }[m
 [m
[31m-          return myContents;[m
[31m-        }[m
 [m
         var page = myStories[i].changes[m].storyOffset.parentTextFrames[0].parentPage;[m
         var userName = myStories[i].changes[m].userName;[m
